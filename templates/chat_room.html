{% extends 'base.html' %} {% block custom_css %}

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
<style>
    .right {
        margin-left: 100px;
    }
    
    #chat-text {
        right: -20%;
        width: 82%;
        position: relative;
        margin-bottom: 100px;
    }
    
    #side_panel {
        position: fixed;
        top: 0px;
        left: 0px;
        background: black;
        z-index: -100;
        height: 100%;
        width: 20%;
        border-right: 1px solid white;
    }
    
    #message_input {
        position: fixed;
        bottom: 0px;
        width: 80%;
        right: 0px;
        z-index: 100;
        border-top: 1px solid white;
        background: black;
        padding: 20px;
    }
    
    .form_group_input {
        display: flex;
    }
    
    .form_control_input {
        width: 370%;
        margin: 10px 30px;
        min-height: 45px;
        border-radius: 10px;
        border: none;
    }
    
    #submit {
        height: 45px;
        margin: 10px 0px;
    }
</style>

{% endblock custom_css %} {% block content %} {% comment %} div.siderbar {% endcomment %}


<div class="container">
    <div id="side_panel">

    </div>




    <!-- <form> -->


    <div class="" id="chat-text">
        {% for mess in room_messages %} {% if request.user.id == mess.sender_id %}
        <p align='right'><b class='sent_by_me' style='color:green'>{{mess.sender_name}}</b> : {{mess.content}} </p>
        {% else %}
        <p><b style='color:red'>{{mess.sender_name}}</b> : {{mess.content}} </p>
        {% endif %} {% endfor %}
    </div><br>


    <div class="footer" id="message_input">
        <div class="form_group_input">
            <input class="form_control_input" id="input" type="text">
            <input class="btn btn-secondary btn-lg btn-block" id="submit" type="button" value="Send">
        </div>
    </div>




    <!-- </form> -->


</div>

{{ request.user.id|json_script:"user_id" }} {{ request.user.first_name|json_script:"user_username" }} {{ room_name|json_script:"room-name" }}

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous">
</script>

{% endblock content %} {% block custom_js %}
<script>
    function scrollBottom() {
        window.scrollTo(0, 99999);
    }
    if (document.addEventListener) document.addEventListener("DOMContentLoaded", scrollBottom, false)
    else if (window.attachEvent) window.attachEvent("onload", scrollBottom);
    const user_username = JSON.parse(document.getElementById('user_username').textContent);
    const user_id = JSON.parse(document.getElementById('user_id').textContent);
    document.querySelector('#submit').onclick = function(e) {
        const messageInputDom = document.querySelector('#input');
        const message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message,
            'username': user_username,
            'user_id': user_id,
        }));
        messageInputDom.value = '';
    };




    const roomName = JSON.parse(document.getElementById('room-name').textContent);

    const chatSocket = new WebSocket(
        'ws://' +
        window.location.host +
        '/ws/forums/' +
        roomName +
        '/'
    );

    chatSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        // console.log(data)
        const name = data.username

        if (user_id == data.user_id) {
            document.querySelector('#chat-text').innerHTML += `<p align='right'><b class='sent_by_me' style='color:green'>${name}</b> : ${data.message} </p>`
        } else {
            document.querySelector('#chat-text').innerHTML += `<p><b style='color:red'>${name}</b> : ${data.message} </p>`
        }
        window.scrollTo(0, document.body.scrollHeight);

    }
</script>

{% endblock custom_js %}

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->